(letrec ((process (lambda (prefix t count)
                   (unless (= count 0)
                     (assert! `(notify ,prefix ,(random)))
                     (sleep t)
                     (process prefix t (- count 1)))))
         (listen (lambda (count)
                   (unless (= count 0)
                     (let ((m (recv)))
                       (display "Complex event: ")
                       (display m)
                       (newline)
                       (listen (- count 1)))))))
  (notify-whenever (spawn (lambda ()
                            (listen 10)))
                   '(filter (and (?notify foo ?foo)
                                 (?notify bar ?bar))
                            (>= ?foo 0.5)
                            (< ?foo 0.75)
                            (<= ?bar 0.1)))
  (process 'foo 1000 100)
  (process 'bar 5000 100))
